# [DB] Oracle DB 이중화

## 1.  DB 이중화란?

```
서버를 이중화 시키는 것과 같이 주 데이터 베이스와 보조 데이터 베이스를 동기화
시키며 데이터와 데이터베이스 개체를 복사 및 배포 하며 일관성을 유지 시킴으로써 
서비스 중단이나 물리적 손상 발생시 복구를 위해 데이터베이스를 복제해 관리하는 것
```

- 스냅샷
    
    특정 시간에 주 서버에 있는 데이터를 보조 서버로 복제함
    
    많은 양의 데이터가 변경되지만 변경 주기가 빈번하지 않을 때 적합함
    
- 트랜잭션 복제
    
    실시간으로 변경 데이터 및 스키마 정보가 전달
    
- 병합 복제
    
    게시자 및 구독자에서 발생한 후속 데이터 변경 및 스키마 수저은 트리거로 추적하고 여러 구독자가 다양한 시간에 동일한 데이터를 업데이트하고 그 변경 내용을 게시자 및 다른 구독자에게 전파할 때 사용 
    

## 2. 데이터베이스 이중화 종류

- Eager 기법
    
    트랜잭션 수행 중 데이터 변경이 발생하면 이중화된 모든 데이터베이스에 즉시 전달하여 변경 내용이 즉시 적용 되는 기법
    
- LAZY 기법
    
    트랜잭션 수행이 종료되면 변경 사실을 새로운 트랜잭션에 작성하여 각 데이터베이스에 전달하는 기법 
    

## 2. 데이터베이스 이중화 구성 방법

### HA ( High Availability)

```
HA 란 2개의 서버를 이용 하여 하나는 Active, 하나는 Standby 상태로 지정해놓고 
Active 서버가 모든 부하를 담당하며 장애가 발생하는 경우 Standby 된 서버가 Active 되며
다시 서비스를 동작할 수 있게 해주는 구성
```

- 각 서버별로 별도의 storage를 가지고 있기 때문에 수시로 동기화가 이루어져야함
- 서버별로 데이터 정합성 문제가 발생 할 수 있음
- Active 된 서버가 동작을 멈추면 Standby 된 서버가 활성화 될 때까지 트랜잭션 유실이 발생

<aside>
💡 서버 구조가 단순하여 비용이 적고, 설치가 쉽지만 동기화로 인한 성능문제가 발생 할 수고 실시간 트랜잭션 처리량이 많은 서비스에는 부적합함
- 장점

- 낮은 비용
- 서비스의 연속성 보장

- 단점

- 실시간 복제되는 데이터로 인한 오류나 바이러스가 전이 될 수 있음
- 별도의 백업 장치가 필요로됨
</aside>

### OPS (Oracle Parallel Server)

```
OPS 은 인스턴스가 하나의 storage를 사용하며 모두 Active 상태로 동작하는 
구조로 이론적으로 부하를 50% 분산할 수 있고, 서비스 성능도 개선이 가능하며
동기화 문제가 없음 
```

- 장점
    - 부하방지
    - 서비스 속도 향상
    - 하나의 서비스가 중단되어도 장애 예방
- 단점
    - RAC Ping
    
    <aside>
    💡 RAC Ping ?
    
    같은 사용자가 각각의 서버에 동시 접속 하였을 경우 서로 다른 인스턴스에서 참조하기 위해서 disk에 저장한 수 다시 불러와야 하는 문제가 발생함
    → 개선하기 위해 RAC구조에서는 Cache Fusion(Disk를 거치지 않음) 기능 사용
    
    </aside>
    

### RAC ( Real Application Cluster)

```
RAC 란 2개 혹은 그 이상의 인스턴스가 하나의 storage에 작업을 하는 구성

- Cache Fusion : 서로 다른 인스턴스에서 변경된 데이터를 디스크를 거치지 않고 바로 가져 
올 수 있게함
```

- 하나의 스토리지에 접근되는 인스턴스들은 Active 된 서버와 같기 때문에 별도의 데이터 동기화로 인한 성능 문제가 없음
- 하나의 인스턴스에 장애가 발생하더라도 다음 인스턴스가 곧바로 작업을 처리하므로 데이터 일치 문제가 발생하지 않게됨

<aside>
💡 HA 보다 빠른 복구 시간을 보장하지만 설치 비용이 높고, 복잡한 환경 구조로 인한 유지보수 비용이 증가 할 수 있음

</aside>